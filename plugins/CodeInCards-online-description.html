CodeInCards - a plugin to embed Python code in cards/card templates
 
Loads substition "libraries" from <pre>%pluginsFolder%/CodeInCards/*.py</pre>
then provides syntax to let you substitute library calls into cards.

Escapes may be included either encoded as HTML or among the markup
(i.e. you can enter them directly in the browser-editor field, or the
"HTML editor".  Four escape formats are supported; the first pair
values brevity over flexibility:

<pre>
  $varName
    Interpolate variable "varName".  Subscripting and dot-whatever
    isn't supported (yet!) but you can use another format.

  $functionName(arg, arg, ...)
    Call "fuctionName" with supplied args, and interpolate the returned
    string, e.g.:
      $myFunc(myVar, "another arg")
    Some things won't work:
      * brackets aren't allowed anywhere in args, so you can't say:
          $functionName("a (broken) example")
      * it's very greedy with the args, so this needs to be split
        across lines: $firstCall("foo") some plain text
          $secondCall("bar")
    You must also be careful with quotes around arguments.  Single
    quotes work best.
</pre>

The second pair is more flexible but more verbose:

<pre>
  {%= &lt;expression&gt; %}
    Evaluates &lt;expression&gt; (a single expression) and substitutes
    result, e.g.:
      {%= 6 * 9 %}
    will yield "42" in the card or template (well, OK, "54").  Function
    calls also work, e.g.:
      {%= functionName("a (working) example", someOtherFunc()) %}

  {% &lt;code&gt; %}
    Executes &lt;code&gt; anything printed to stdout gets substituted, e.g.:
      {%
      if random.randint(0, 1000000) == 42:
        print "The Ultimate Answer!"
      %}
</pre>

Apart from globals in your libraries you can also use the following
symbols:
<pre>
   QorA - 'q' or 'a', depending what card side is being rendered
   card - the card being rendered; see the Anki source
</pre>

Compile errors get interpolated as HTML-ized strings.

The string '&lt;br /&gt; is removed from within code if present before
executione.  This allows you to add code in the card editor as well as
card templates but means you can't include a BR in an escape.  If
that matters to you, define a variable in your library called "BR" and
use than in place of "&lt;br/&gt;  No other HTML is removed, so be careful
not to style any part of an escape entered in an card editor field.

Get a small example library here:<pre>
<a href="http://bit.ly/codeincards">http://bit.ly/codeincards</a>
<pre>then save it in %pluginsFolder%/CodeInCards/ and read it to see some
trivial examples.
 
<pre>
Caveats:
  - This module is a gaping security hole if you ever import cards from
    untrusted sources.
  - At the moment there's no way to prevent the escapes appearing in the
    browser, so cards start to look quite ugly.
  - It's too easy to get carried away and implement your own SRS
    mini-language packed with syntactic sugar.
</pre>

TODO: add individual fact fields alongside QorA and card in a dict
  (need to marry up card.fact.values with card.model.names)<br/>
TODO: implement m4's 'dnl' feature - perhaps by terminating a
  multiline with "%}." instead of "%}"<br/>
TODO: reload libraries without restarting Anki<br/>
TODO: support $foo['index'] and maybe $foo.bar and $foo.bar()<br/>
TODO: remove escapes from browser; there's no hook, but a sick hack
  might be to wrap stripHTML()<br/>